<!DOCTYPE html>
<html>

<head>
  <title>Login</title>
  <link rel="stylesheet" href="styles.index.css">
</head>

<body class="backgroundAni">
  <div class="center">

    <div id="login-div" class="boxoutline">
      <h1 id="login-header">Login</h1>
      <form id="login-form" action="/login" method="post">
        <fieldset>
          <legend><label for="email">Email:</label><br></legend>
          <input type="text" id="email-login" name="email"><br>
        </fieldset>
        <fieldset>
          <legend><label for="password">Password:</label><br></legend>
          <input type="password" id="password-login" name="password"><br>
        </fieldset>
        <br>
        <input type="submit" value="Submit">
      </form>
      <br>
      <a href="#" onclick="showSignup()">Don't have an account? Sign Up</a>
    </div>

    <div id="signup-div" style="display:none;" class="boxoutline">
      <h1 id="signup-header">Signup</h1>
      <form id="signup-form" action="/signup" method="post">
        <fieldset>
          <legend><label for="name">Displayname:</label><br></legend>
          <input type="text" id="displayname-signup" name="name"><br>
        </fieldset>
        <fieldset>
          <legend><label for="name">Name:</label><br></legend>
          <input type="text" id="name-signup" name="name"><br>
        </fieldset>
        <fieldset>
          <legend><label for="email">Email:</label><br></legend>
          <input type="text" id="email-signup" name="email"><br>
        </fieldset>
        <fieldset>
          <legend><label for="password">Password:</label><br></legend>
          <input type="password" id="password-signup" name="password"><br>
        </fieldset>
        <br>
        <input type="submit" value="Signup">
      </form>
      <br>
      <a href="#" onclick="showLogin()" style="display:none;">Already have an account? Login</a>
    </div>

  </div>

  <script>
    const passwordPlaceholder = "8-32; Upper/Lowercase; Number";//"Length between 8 and 32 characters, at least one Upper/Lowercase letter and one number";
    document.getElementById("password-signup").placeholder = passwordPlaceholder;
    document.getElementById("password-login").placeholder = passwordPlaceholder;
    document.getElementById("name-signup").placeholder = "Lowercase only";

    function showSignup() {
      document.getElementById("login-div").style.display = "none";
      document.getElementById("signup-div").style.display = "block";
      document.querySelector("a[onclick='showSignup()']").style.display = "none";
      document.querySelector("a[onclick='showLogin()']").style.display = "block";
      document.title = "Signup";
    }

    function showLogin() {
      document.getElementById("signup-div").style.display = "none";
      document.getElementById("login-div").style.display = "block";
      document.querySelector("a[onclick='showLogin()']").style.display = "none";
      document.querySelector("a[onclick='showSignup()']").style.display = "block";
      document.title = "Login";
    }

    //Prevent form from submitting so we can use fetch
    document.getElementById("signup-form").addEventListener("submit", function (event) {
      event.preventDefault();

      const displayName = document.getElementById("displayname-signup").value;
      const name = document.getElementById("name-signup").value;
      const email = document.getElementById("email-signup").value;
      const password = document.getElementById("password-signup").value;

      sendAccountData('/signup', {
        displayName: displayName,
        name: name,
        email: email,
        password: password
      });
    });

    document.getElementById("login-form").addEventListener("submit", function (event) {
      event.preventDefault();

      const email = document.getElementById("email-login").value;
      const password = document.getElementById("password-login").value;

      sendAccountData('/login', {
        email: email,
        password: password
      });
    });

    function sendAccountData(url, body) {
      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(body)
      })
        .then(response => response.json())
        .then(data => {
          console.log(data);
          if (data.success) {
            window.location.href = "/dashboard.html";
          } else {
            //Rewrite this to some css magic
            alert(data.error);
          }
        });
    }
  </script>
</body>

</html>